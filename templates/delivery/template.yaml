version: 1
name: Delivery Pipeline
displayName: Delivery Pipeline
description: Pipeline for building, scanning, and publishing a container image.
type: pipeline-template
parameters:
  - name: default_image
    displayName: Image
    description: The fully qualified container image name (including the registry).
    type: string
    defaultValue: "docker.io/my-app"
  - name: default_tag
    displayName: Image Tag
    type: string
    defaultValue: "latest"
  - name: registry_credentials
    displayName: Registry Credentials
    type: credentials
  - name: image_registry_auth_json
    displayName: Image Registry Auth JSON
    type: credentials
  - name: image_push_enabled
    displayName: Enable Image Push
    description: "Optionally, enable image push to the container registry (requires credentials)."
    type: boolean
    defaultValue: false
  - name: default_build_args
    displayName: Build Arguments
    description: "A JSON object of build arguments to pass to the container build process."
    type: string
    defaultValue: "{}"
  - name: default_build_dir
    displayName: Build Directory
    description: "The directory to use as the build context for the container build."
    type: string
    defaultValue: "."
  - name: default_dockerfile
    displayName: Dockerfile
    type: string
    defaultValue: "Dockerfile"
  - name: default_build_target
    displayName: Build Target
    description: "The build target to use when building the container image (for use with multi-stage Dockerfiles)."
    type: string
  - name: default_kaniko_memory_limit
    displayName: Kaniko Memory Limit
    description: "Kaniko memory limit input for those larger builds."
    defaultValue: "1Gi"
    type: string
  - name: default_platform
    displayName: Platform
    description: "A comma separated list of platforms to build the container image for (e.g., linux/amd64,linux/arm64)."
    type: string
    defaultValue: "linux/amd64"
  - name: copy_artifacts_job_name
    displayName: Copy Artifacts Job Name
    description: "The Jenkins job name from which to copy artifacts."
    type: string
    defaultValue: ""
  - name: copy_artifacts_build_number
    displayName: Copy Artifacts Build Number
    description: "The specific build number from which to copy artifacts. Should be provided by upstream job."
    type: string
    defaultValue: ""
  - name: copy_artifacts_filter
    displayName: Copy Artifacts Filter
    description: "The file filter identifying which artifacts to copy."
    type: string
    defaultValue: ""        
  - name: enable_ansi_colors
    displayName: Enable ANSI Colors
    description: "Enable ANSI color output in the Jenkins console (requires AnsiColor plugin)."
    type: boolean
    defaultValue: true
  - name: enable_cache
    displayName: Enable Kaniko Cache
    description: "Enable Kaniko image build cache."
    type: boolean
    defaultValue: true
  - name: enable_compressed_caching
    displayName: Enable Kaniko Compressed Caching
    description: "Enable Kaniko tar compression for cached layers. Note: This decreases build runtimes but increases memory usage (especially for large builds)."
    type: boolean
    defaultValue: false
